<html>
    
    <body  id="body-pd">
        <header class="header" id="header">
            <div class="header_toggle"> <i class='bx bx-menu' (click)="toggleNavbar()" id="header-toggle"></i> </div>
			
           <div class="header_user">
            <div class="header_text">{{this.username}}</div>
            <div class="header_img"> <img src="assets/profiles/users/img{{this.username}}.png"  onerror="this.src='assets/profiles/defaut.png'" alt=""> </div>
    </div>
        </header>

        <div class="l-navbar" id="nav-bar">
            <nav class="nav">
                <div> 
                  
                    <a class="nav_logo"  >
                      <img id="logo" src="{{logo}}" class="img-fluid" width="0" height="0">
                      
                      
                    </a>
                    <div class="nav_list"> 
                       
                        <a routerLink="/patient"  class="nav_link active"> 
                            <i class='bx bx-user nav_icon'></i> 
                            <span class="nav_name">Patients</span> 
                        </a> 
                        <a routerLink="/events"  class="nav_link"> 
                            <i class='bx bx-calendar nav_icon'></i> 
                            <span class="nav_name">Rendez-Vous</span> 
                        </a> 
                        <a routerLink="/compta"  class="nav_link"> 
                            <i class='bx bx-calculator nav_icon'></i> 
                            <span class="nav_name">Activités</span> 
                        </a> 
                        
                        <a routerLink="/stat"  class="nav_link"> 
                            <i class='bx bx-bar-chart-alt-2 nav_icon'></i> 
                            <span class="nav_name">Statistique</span> 
                        </a> 
                        <a routerLink="/employes"  class="nav_link "> 
                          <i class='bx bx-grid-alt nav_icon'></i> 
                          <span class="nav_name">Employés</span> 
                      </a> 
                        <a  *ngIf="this.role=='superadmin'" routerLink="/parametres"  class="nav_link"> 
                          <i class='bx bx-certification nav_icon'></i> 
                          <span class="nav_name">Administration</span> 
                      </a> 
                    </div>
                </div> 
                <a (click)="logout()"  class="nav_link"> 
                    <i class='bx bx-log-out nav_icon'></i> 
                    <span class="nav_name">Déconnexion</span> 
                </a>
            </nav>
        </div>

        <div class="height-100 bg-light">
            <div class="container">
            <div class="main-body">
 <div class="row gutters-sm">
            <div class="col-md-4 mb-3">
              <div class="card">
                <div class="card-body">
                  <div class="d-flex flex-column align-items-center text-center">
                    <div class="containerimg">
                    <img src="{{imgurl}}" onerror="this.src='assets/profiles/defaut.png'" alt="Admin" class="rounded-circle" width="180" height="150">
                    <div class="text-overlay" (click)="tempmodifierimg(templateimg)">Changer la photo</div>
                  </div>
                    <div class="mt-3">
                      <h5>{{this.infospat?.pnom}}</h5>
                        <i  *ngIf="patst=='encours'" style="font-size: 2em;color:green" class='bx bx-check-circle nav_icon'></i> 
                        <i  *ngIf="patst!='encours'" style="font-size: 2em;color:red" class='bx bx-x-circle nav_icon'></i> 

                        <p class="text-muted "></p>
                      <div class="button-container">
                      <button (click)="tempmodifierpatien(templatemodifpatien)" class="btn btn-primary">Modifier</button>
                      <button *ngIf="patst=='encours'" (click)="activer('inactif')" class="btn btn-outline-primary">Désactiver</button>
                      <button *ngIf="patst!='encours'" (click)="activer('actif')" class="btn btn-outline-primary">Activer</button>
                    </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
            <div class="col-md-8">
              <div class="card mb-3">
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Numéro Téléphone 
                      </h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      {{this.infospat?.ptel}}
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Date Naissance</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      {{this.infospat?.pnai | date:'dd-MM-yyyy'}}
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Genre </h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      {{this.infospat?.pgnr}}
                    </div>
                  </div>
                  <hr>
                 
                 
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Adresse</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      {{this.infospat?.padrss}}
                    </div>
                  </div>
                  
                  <hr>

                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Date D'ajout</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      {{this.infospat?.pdaj | date:'dd-MM-yyyy'}}
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-12">
                      <a class="btn btn-danger" (click)="supprimerpatient()">Supprimer</a>
                    </div>
                  </div>
                  
                </div>
              </div>


        </div>
    </div>
    <div class="container ">
        <!-- For demo purpose -->
        
        <div class="p-5 bg-white rounded shadow mb-5">
          <!-- Lined tabs-->
          <ul id="myTab2" role="tablist" class="nav nav-tabs nav-pills with-arrow lined flex-column flex-sm-row text-center">
            <li class="nav-item flex-sm-fill">
              <a id="dossier" data-toggle="tab" (click)="showTab('dossier',true)" role="tab" aria-controls="home2" aria-selected="false"  class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0 active">Dossiers Médicaux </a>
            </li>
            <li class="nav-item flex-sm-fill">
              <a id="consultation" data-toggle="tab" (click)="showTab('consultation',true)" role="tab" aria-controls="profile2" aria-selected="true"  class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0 "> Consultations</a>
            </li>
            <li class="nav-item flex-sm-fill">
              <a id="rendezvous" data-toggle="tab" (click)="showTab('rendezvous',true)" role="tab" aria-controls="profile2" aria-selected="true"  class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0 "> Rendez Vous</a>
            </li>
            <li class="nav-item flex-sm-fill">
              <a id="documents" data-toggle="tab" (click)="showTab('documents',true)" role="tab" aria-controls="contact2" aria-selected="false"  class="nav-link text-uppercase font-weight-bold rounded-0">Documents</a>
            </li>
          </ul>
          <div id="myTab2Content" class="tab-content">
            <div id="dossier" role="tabpanel" aria-labelledby="home-tab" class="tab-pane fade show active  ">
              <button *ngIf="!inchargement" (click)="tempadddossier(templateadddossier)" class="btn btn-primary new"><i class="fa fa-plus"></i> Ajouter un dossier</button>
              <div class="container">
                <div  *ngIf="inchargement" class="chargcontainer">
                  <div class="image-container">
                    <img [src]="charg"  >
                  </div>
                </div> 
                <div *ngIf="!inchargement" class="row">
                    <div class="col-lg-4"  *ngFor="let dos of dossiers">
                        <div class="card card-margin">
                            <div class="card-header no-border">
                               
                            </div>
                            <div class="card-body pt-0">
                                <div class="widget-49">
                                    <div class="widget-49-title-wrapper">
                                        <div class="widget-49-date-primary">
                                            <span class="widget-49-date-month">{{dos.ddate| date:'dd'}}</span>
                                            <span class="widget-49-date-month2">{{getMonthName(dos.ddate| date:'MM')}}</span>
                                            <span class="widget-49-date-month">{{dos.ddate| date:'yyyy'}}</span>
                                        </div>
                                        <div class="widget-49-meeting-info">
                                            <span  *ngIf="!dos.prischrg" class="widget-49-pro-title">Remise : {{dos.dremise}}%</span>
                                            <span *ngIf="!dos.prischrg" class="widget-49-meeting-time">Total : {{dos.dmntar}} UM</span>
                                            <span *ngIf="dos.prischrg" class="widget-49-meeting-time">Total : {{dos.dmntbr}} UM</span>
                                            <ng-container  *ngIf="!dos.prischrg">
                                            <span *ngIf="dos.dassur" style="color: green;" class="widget-49-meeting-time">Assuré : {{dos.dassurtaux}}%</span>
                                            <span *ngIf="!dos.dassur" style="color:red"  class="widget-49-meeting-time">Non Assuré</span>
                                          </ng-container>
                                            <span *ngIf="dos.prischrg" style="color: green;" class="widget-49-meeting-time">Pris en charge</span>
                                            <span class="widget-49-meeting-time">Montant à payer : {{dos.dclmnt}} UM</span>
                                            <span *ngIf="!dos.dvalide"  style="color:red"  class="widget-49-meeting-time">En cours de validation</span>
                                          </div>
                                    </div>
                                    <ol  class="widget-49-meeting-points">
                                        <li *ngFor="let detail of dos.details; let i = index" class="widget-49-meeting-item"><span>{{ gettraitById(detail.split(',')[0]) }} [{{ detail.split(',')[2] }}]</span></li>
                                    </ol>
                                    <div class="widget-49-meeting-action">
                                      <!-- <div class="btn-group"> -->
                                        <button *ngIf="!dos.dvalide || this.role=='superadmin'"  id="editButton" (click)="tempmoddossier(templatemoddossier,dos.did)" class="btn btn-primary btn-circle btn-circle-sm m-1" title="Modifier"><i class="fa fa-edit"></i></button>
                                        <button  *ngIf="!dos.dvalide || this.role=='superadmin'" id="deleteButton" (click)="deldossier(dos.did)" class="btn btn-danger btn-circle btn-circle-sm m-1" title="Supprimer"><i class="fa fa-trash"></i></button>
                                        <button id="deleteButton" (click)="tempinforendez(dos.dnote)" class="btn btn-info btn-circle btn-circle-sm m-1" title="Info"><i class="fa fa-info"></i></button>
                                        <button id="deleteButton" (click)="tempaddjoursrendez(templateaddjoursrendez,dos.did)" class="btn btn-secondary btn-circle btn-circle-sm m-1" ><i class="fa fa-calendar-check-o"></i></button>
    
                                     
                                      <!-- </div> -->
                                      <button id="deleteButton" (click)="tempinvoice(dos.did)"class="btn btn-warning btn-circle btn-circle-sm m-1" title="Info"><i class="fa fa-file"></i></button>
                                     

                                        <a  *ngIf="dos.dvalide " (click)="tempdetails(dos.did)"  class="btn btn-sm btn-flash-border-primary">détails</a>
 
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                
                </div>
                </div>
                      
              
         
       
            </div>
            <div id="consultation" role="tabpanel" aria-labelledby="contact-tab" class="tab-pane fade  ">
              <div class="container flex-grow-1 light-style container-p-y">
                <div  *ngIf="inchargement" class="chargcontainer">
                  <div class="image-container">
                    <img [src]="charg"  >
                  </div>
                </div>
          <div *ngIf="!inchargement" class="container-m-nx container-m-ny bg-lightest mb-3">
              
            <button (click)="tempaddcons(templateaddcons)" class="btn btn-primary new"><i class="fa fa-plus"></i> une nouvelle consultation</button>
      
              <hr class="m-0" />
          </div>
      
          <div class="file-manager-container file-manager-col-view">
              
      
             
      
              
      
              
              <div class="file-item" *ngFor="let cons of cons | paginate: {id:'pagination4', itemsPerPage: 10, currentPage: pages}">
                  <div class="file-item-select-bg bg-primary"></div>
                  <label class="file-item-checkbox custom-control custom-checkbox">
                    
                      <span class="custom-control-label"></span>
                  </label>
                  <button id="deleteButton" (click)="tempinvoicecons(cons.cid)"class="btn btn-warning btn-circle btn-circle-sm m-1" title="Info"><i class="fa fa-file"></i></button>
                  <!-- <a (click)="downloadfile(file.name)"  class="file-item-name">
                     {{file.name}}
                  </a> -->
                  <br>
                  <a   class="file-item-date">
                    {{cons.cdate| date:'dd-MM-yyyy'}}
                 </a>
                  <div class="file-item-changed"> </div>
              
                 

                  <div class="btn-group">
          <button id="editButton" (click)="tempmodcons(templatemodcons,cons.cid)"  class="btn btn-primary btn-circle btn-circle-sm m-1" title="Edit"><i class="fa fa-edit"></i></button>
          <button id="deleteButton"  (click)="delcons(cons.cid)" class="btn btn-danger btn-circle btn-circle-sm m-1" title="Delete"><i class="fa fa-trash"></i></button>
        </div>

              </div>
      
            

             
      
              
      
              
      
              
          </div>
          <pagination-controls *ngIf="!inchargement" id="pagination4" (pageChange)=" pagesfile = $event" previousLabel="Précédente" nextLabel="Suivante" class="page"></pagination-controls>

      </div>
            </div>
            <div id="rendezvous" role="tabpanel" aria-labelledby="profile-tab" class="tab-pane fade   ">
              
             
		
              <div class="event-schedule-area-two bg-color ">
              
                <div class="container">
                  <div  *ngIf="inchargement" class="chargcontainer">
                    <div class="image-container">
                      <img [src]="charg"  >
                    </div>
                  </div>
                    <!-- row end-->
                    <div  *ngIf="!inchargement" class="row">
                        
                            
                            <div class="tab-content" id="myTabContent">
                              <button (click)="tempaddrendez(templateaddrendez)" class="btn btn-primary new"><i class="fa fa-plus"></i> Planifier un rendez-vous</button>
                              <button  (click)="annuller()" id="deleteButton" class="btn btn-danger new" title="Supprimer"><i class="fa  fa-window-close"></i></button>

                              <br>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th class="text-center" scope="col">Date</th>
                                                  
                                                    <th scope="col">État</th>
                                                  
                                                    <th  scope="col">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let ev of events | paginate: {id:'pagination', itemsPerPage: 30, currentPage: pages}" class="inner-box">
                                                    <th scope="row">
                                                        <div class="event-date">
                                                            <span>{{ev.edate| date:'dd'}}-{{getMonthName(ev.edate| date:'MM')}}-{{ ev.etime | slice: 0:5 }}</span>
                                                           
                                                        </div>
                                                    </th>
                                                   
                                                   
                                                       
                                                    <td>
                                                        <div class="r-no">
                                                          <span [style.color]="getColorByStatus(ev.estat)">
                                                            {{ ev.estat }}
                                                        </span>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="primary-btn">
                                                          <button id="deleteButton" (click)="tempinforendez(ev.enote)"class="btn btn-info btn-circle btn-circle-sm m-1" title="Info"><i class="fa fa-info"></i></button>
                                                          <button id="editButton" (click)="tempmodrendez(templatemodrendez,ev.eid)" class="btn btn-primary btn-circle btn-circle-sm m-1" title="Modifier"><i class="fa fa-edit"></i></button>
                                                          <button id="deleteButton" (click)="delrendezvous(ev.eid)" class="btn btn-danger btn-circle btn-circle-sm m-1" title="Supprimer"><i class="fa fa-trash"></i></button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                
                                            </tbody>
                                        </table>
                                        <pagination-controls id="pagination" (pageChange)=" pages = $event" previousLabel="" nextLabel="" class="page"></pagination-controls>

                                    </div>
                                </div>
                       
                           
                          
                        
                        <!-- /col end-->
                    </div>
                    <!-- /row end-->
                </div>
            </div>
              
              
            </div>
            <div id="documents" role="tabpanel" aria-labelledby="contact-tab" class="tab-pane fade  ">
              <div class="container flex-grow-1 light-style container-p-y">
                <div  *ngIf="inchargement" class="chargcontainer">
                  <div class="image-container">
                    <img [src]="charg"  >
                  </div>
                </div>
          <div *ngIf="!inchargement" class="container-m-nx container-m-ny bg-lightest mb-3">
              
            <button (click)="tempadddoc(templateadddoc)" class="btn btn-primary new"><i class="fa fa-plus"></i> Importer un nouveau document</button>
      
              <hr class="m-0" />
          </div>
      
          <div class="file-manager-container file-manager-col-view">
              
      
             
      
              
      
              
              <div class="file-item" *ngFor="let file of listfiles | paginate: {id:'pagination2', itemsPerPage: 10, currentPage: pagesfile}">
                  <div class="file-item-select-bg bg-primary"></div>
                  <label class="file-item-checkbox custom-control custom-checkbox">
                    
                      <span class="custom-control-label"></span>
                  </label>
                  <div class="file-item-icon fa fa-file-pdf-o text-secondary"></div>
                  <a (click)="downloadfile(file.name,file.type)"  class="file-item-name">
                     {{file.name}}
                  </a>
                  <a   class="file-item-date">
                    {{file.creationDate | date:'dd-MM-yyyy'}}
                 </a>
                  <div class="file-item-changed"> </div>
                  <div class="btn-group">
          <button id="editButton" (click)="tempmoddoc(templatemoddoc,file.name,file.type)"  class="btn btn-primary btn-circle btn-circle-sm m-1" title="Edit"><i class="fa fa-edit"></i></button>
          <button id="deleteButton"  (click)="deletedoc(file.name,file.type)" class="btn btn-danger btn-circle btn-circle-sm m-1" title="Delete"><i class="fa fa-trash"></i></button>
        </div>
              </div>
      
            

             
      
              
      
              
      
              
          </div>
          <pagination-controls *ngIf="!inchargement" id="pagination2" (pageChange)=" pagesfile = $event" previousLabel="Précédente" nextLabel="Suivante" class="page"></pagination-controls>

      </div>
            </div>
          </div>
          <!-- End lined tabs -->
         
        </div>
      
      </div>


                </div>
                </div>
                </div>
         <!--Container Main end-->
         <ng-template #templatemodifpatien>
          <div class="modal-header">
            <h4 class="modal-title pull-left">Éditer les informations du patient</h4>
            <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
              <span aria-hidden="true" class="visually-hidden">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="c1">
              <form [formGroup]="formAddpatient" (ngSubmit)="modpatient()" >
                <div class="row">
              <div class="col" >
                <label class="labelmod" for="Nom">Nom /Prénom <span>*</span></label>
                <input  class="input" maxlength="30"  type="text" formControlName="Nom" placeholder="Nom / Prénom ..">
              </div>
              <div class="col" >
                <label class="labelmod" for="TL">Telephone <span>*</span> </label>
            <input  class="input" type="number" formControlName="TL" placeholder="Telephone ..">
               
              </div>
                </div>
                <div class="row">
                  <div class="col" >
                    <label class="labelmod" >Genre <span>*</span></label>
                    <select    formControlName="GNR" >
                      <option   value="Masculin" >Masculin</option>
                      <option   value="Féminin" >Féminin</option>
                    </select>
                  </div>

                  <div class="col" >
                <label class="labelmod" for="DN">Date Naissance <span>*</span></label>
                <input   type="DATE"  formControlName="DN" placeholder="Date Naissance..">
              </div>
              
                </div>
          
                <div class="row">
                  <div class="col" >
                    <label class="labelmod" for="Nom">Adresse <span>*</span></label>
                    <input  class="input"   type="text" formControlName="ADRS" placeholder="Adresse ..">
              </div>
              <div class="col" >
                <label class="labelmod" for="DN">Date D'ajout <span>*</span></label>
                <input   type="DATE"  formControlName="DA" placeholder="Date D'ajout ..">
              </div>
                </div>
      
      
      
               
          
                <div  *ngIf="formAddpatient.invalid">
                  <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                </div>
          
                <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
          
              </form>
            </div>
            </div>
            </ng-template>    
      
            
            <ng-template #templateaddjoursrendez>
              <div class="modal-header">
                <h4 class="modal-title pull-left"> Fixer les jours de rendez-vous pour le patient</h4>
                <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
                  <span aria-hidden="true" class="visually-hidden">&times;</span>
                </button>
              </div>
              <div class="modal-body">
               
                    
                      <div class="c1">
                      
                        <div class="dayweek text-center">
                          <label class="checkbox-inline">
                            <input type="checkbox" id="Check1" value="1" (change)="toggleDay($event, 1, 'Lundi')"> Lundi
                          </label>
                          <label class="checkbox-inline">
                            <input type="checkbox" id="Check2" value="2" (change)="toggleDay($event, 2, 'Mardi')"> Mardi
                          </label>
                          <label class="checkbox-inline">
                            <input type="checkbox" id="Check3" value="3" (change)="toggleDay($event, 3, 'Mercredi')"> Mercredi
                          </label>
                          <label class="checkbox-inline">
                            <input type="checkbox" id="Check4" value="4" (change)="toggleDay($event, 4, 'Jeudi')"> Jeudi
                          </label>
                          <label class="checkbox-inline">
                            <input type="checkbox" id="Check5" value="5" (change)="toggleDay($event, 5, 'Vendredi')"> Vendredi
                          </label>
                          <label class="checkbox-inline">
                            <input type="checkbox" id="Check6" value="6" (change)="toggleDay($event, 6, 'Samedi')"> Samedi
                          </label>
                          <label class="checkbox-inline">
                            <input type="checkbox" id="Check7" value="7" (change)="toggleDay($event, 7, 'Dimanche')"> Dimanche
                          </label>
                        </div>
                        <br><br>
                        <table *ngIf="weekday.length!=0" class="nbreseance-table">
                          <tr class="nbreseance-row">
                            <th class="nbreseance-header">Le Jour</th>
                            <th class="nbreseance-header">L'Heure</th>
                            
                          </tr>
                          <tr class="nbreseance-row" *ngFor="let item of this.weekday; let i = index">
                            <td class="nbreseance-cell">{{ item.name }}</td>
                           
                            <td class="nbreseance-cell nbre">
                              <input type="time" [value]="item.heure" (change)="updateTime($event, i)">
                            </td>
                            
                          </tr>
                         
                        </table>
                        <input *ngIf="weekday.length!=0" [disabled]="buttondisable==true" type="submit" (click)="addjourrend()" value="Changer">
                </div>
                </div>
                </ng-template>  
            
            <!-- image profile-->
<ng-template #templateimg>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Mettre à jour la photo du patient</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="c1">
    <form [formGroup]="formimg" (ngSubmit)="imgupload()" >
      <div class="row">
        <div class="col" >
      
          <input formControlName="IMG" type="file"   (change)="onFileChange($event)">
    </div>  
      </div>
      <input  [disabled]="buttondisable==true" type="submit" value="Changer">

    </form>
  </div>
  </div>
</ng-template>

<ng-template #templateadddossier>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Ajouter un dossier</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
   
        
          <div class="c1">
            <form [formGroup]="formAdddossier" (ngSubmit)="adddossier()" >
              <div class="row">
            <div class="col" >
              <label class="labelmod" for="Nom">Date <span>*</span></label>
              <input  class="input"   type="date" formControlName="DT" >
            </div>
            <div class="col" >
              <label class="labelmod" > Remise<span>*</span> </label>
              <input [readOnly]="this.pris==true"  formControlName="RMS"  (change)="tauxremisechange($event)" type="number" min="0" max="100" value=0>
             
            </div>
              </div>
              <div class="row">
                <div class="col" >
                  <label class="labelmod" >Traitement<span>*</span> </label>
                  <ng-select class="custom"
                  [items]="listraitinseance"
                  bindLabel="name"
                  placeholder="Sélectionner des traitements"
                  appendTo="body"
                  [multiple]="true"
                  [closeOnSelect]="false"
    [searchable]="false"
    formControlName="TR"
    (change)="onSelectionChange2($event)">
                 >
                </ng-select>
                </div>
      
              
                <div class="col">
                  <label class="labelmod" > Couverture D'Assurance</label>
                  <select  [attr.disabled]="this.pris ==true ? true : null"  (change)="tauxchange($event)"   formControlName="ASSRID" >
                    <option   value="0" > Non assuré</option>
                    <option *ngFor="let assr of assurs"  value="{{assr.asid}}">{{assr.asnm}}</option>  
                  </select>

                </div>
              </div>

              <div class="row">
               
              
                <div class="col" >
                  <label class="labelmod" >Le taux de couverture</label>
                  <input [readOnly]="this.pris==true" (change)="tauxassurchange($event)" type="number"  min="0" max="100" value="0" formControlName="ASSRTAUX" >
                </div>
                <div class="col" >
                  <label class="labelmod">Pris en charge</label>
                  <input  (change)="prischange($event)"  type="checkbox" formControlName="DPRIS" >
            </div>
                </div>

                <div class="row">
                     
                 
                  <div class="col" >
                    <label class="labelmod">Notes </label>
                    <textarea formControlName="NOTE" cols="40" rows="5"></textarea>
              </div>

              <div class="col" >
                    
              </div>
                  </div>
             
               
      
      
             
        <br>
        
        <table class="nbreseance-table">
          <tr class="nbreseance-row">
            <th class="nbreseance-header">Traitement</th>
            <th class="nbreseance-header">Tarif</th>
            <th class="nbreseance-header">Nbre séances</th>
            <th class="nbreseance-header">Total</th>
          </tr>
          <tr class="nbreseance-row" *ngFor="let item of selected; let i = index">
            <td class="nbreseance-cell">{{ item.name }}</td>
            <td class="nbreseance-cell nbre">
              <input type="number" #prixInput (input)="updateprix(i, prixInput.value)" value="{{ item.prix }}">
            </td>
            <td class="nbreseance-cell nbre2">
              <input type="number" #nbreInput (input)="updateNbre(i, nbreInput.value)" value="{{ item.nbre }}">
            </td>
            <td class="nbreseance-cell nbre">
              <input type="number" readonly value="{{ (item.prix *item.nbre).toFixed(2)  }}">
            </td>
          </tr>
          <ng-container *ngIf="selected.length!=0">
          <tr class="nbreseance-row">
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal">Total</td>
            <td class="nbreseance-celltotal">{{total()| number : '1.2-2'}}</td>
          </tr>
          <tr class="nbreseance-row">
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal">Remise ({{remise*100}}%)</td>
            <td class="nbreseance-celltotal">{{(total()*remise)| number : '1.2-2'}}</td>
          </tr>
          <tr class="nbreseance-row">
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal">Total Général </td>
            <td [hidden]="this.pris==true" class="nbreseance-celltotal">{{(total()-(total()*remise)) | number : '1.2-2'}}</td>
            <td [hidden]="this.pris!=true" class="nbreseance-celltotal">{{0 | number : '1.2-2' }}</td>

          </tr>
          </ng-container>
        </table>
        <ng-container *ngIf=" this.assurtaux!=0&& selected.length!=0 " >
<span class="assurance"> Montant à payer : {{(total()-(total()*remise))*(1-assurtaux) | number : '1.2-2' }} Montant assuré : {{(total()-(total()*remise))*assurtaux | number : '1.2-2'}}</span>
</ng-container>
<br><br>
              <div  *ngIf="formAdddossier.invalid">
                <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
              </div>
              <input type="submit" [disabled]="buttondisable==true"  value="Ajouter">
             
             
         

        
            </form>

    </div>
    </div>
    </ng-template>  

    
<ng-template #templatemoddossier>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Mettre à jour un dossier</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
   
        
          <div class="c1">
            <form [formGroup]="formAdddossier" (ngSubmit)="moddossier()" >
              <div class="row">
                <div class="col" >
                  <label class="labelmod" for="Nom">Date <span>*</span></label>
                  <input  class="input"   type="date" formControlName="DT" >
                </div>
                <div class="col" >
                  <label class="labelmod" > Remise<span>*</span> </label>
                  <input [readOnly]="this.pris==true"   formControlName="RMS"  (change)="tauxremisechange($event)" type="number" min="0" max="100" value=0>
                 
                </div>
                  </div>
                  <div class="row">
                    <div class="col" >
                      <label class="labelmod" >Traitement<span>*</span> </label>
                      <ng-select class="custom"
                      [items]="listraitinseance"
                      bindLabel="name"
                      placeholder="Sélectionner des traitements"
                      appendTo="body"
                      [multiple]="true"
                      [closeOnSelect]="false"
        [searchable]="false"
        formControlName="TR"
        (change)="onSelectionChange2($event)">
                     >
                    </ng-select>
                    </div>
          
                  
                    <div class="col">
                      <label class="labelmod" > Couverture D'Assurance</label>
                      <select  [attr.disabled]="this.pris ==true ? true : null"  (change)="tauxchange($event)"   formControlName="ASSRID" >
                        <option   value="0" > Non assuré</option>
                        <option *ngFor="let assr of assurs"  value="{{assr.asid}}">{{assr.asnm}}</option>  
                      </select>
    
                    </div>
                  </div>
    
                  <div class="row">
                   
                  
                    <div class="col" >
                      <label class="labelmod" >Le taux de couverture</label>
                      <input  [readOnly]="this.pris==true" (change)="tauxassurchange($event)" type="number"  min="0" max="100" value="0" formControlName="ASSRTAUX" >
                    </div>
                    <div class="col" >
                      <label class="labelmod" >Validation <span>*</span></label>
                      <select  [attr.disabled]="this.role !== 'superadmin' ? true : null"  formControlName="DVALIDE" >
                        <option   value=false >Encours</option>
                        <option   value=true >Validé</option>
                      </select>
                </div>
                    </div>
                    <div class="row">
                      <div class="col" >
                        <label class="labelmod">Notes </label>
                        <textarea formControlName="NOTE" cols="40" rows="5"></textarea>
                  </div>
                   <div class="col" >
                  <label class="labelmod">Pris en charge</label>
                  <input  (change)="prischange($event)"  type="checkbox" formControlName="DPRIS" >
                </div>
            </div>
                 
                   
          
          
                 
            <br>
            
            <table class="nbreseance-table">
              <tr class="nbreseance-row">
                <th class="nbreseance-header">Traitement</th>
                <th class="nbreseance-header">Tarif</th>
                <th class="nbreseance-header">Nbre séances</th>
                <th class="nbreseance-header">Total</th>
              </tr>
              <tr class="nbreseance-row" *ngFor="let item of selected; let i = index">
                <td class="nbreseance-cell">{{ item.name }}</td>
                <td class="nbreseance-cell nbre">
                  <input type="number" #prixInput (input)="updateprix(i, prixInput.value)" value="{{ item.prix }}">
                </td>
                <td class="nbreseance-cell nbre">
                  <input type="number" #nbreInput (input)="updateNbre(i, nbreInput.value)" value="{{ item.nbre }}">
                </td>
                <td class="nbreseance-cell nbre">
                  <input type="number" readonly value="{{ item.prix *item.nbre }}">
                </td>
              </tr>
              <ng-container *ngIf="selected.length!=0">
              <tr class="nbreseance-row">
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal">Total</td>
                <td class="nbreseance-celltotal">{{total()| number : '1.2-2'}}</td>
              </tr>
              <tr class="nbreseance-row">
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal">Remise ({{remise*100}}%)</td>
                <td class="nbreseance-celltotal">{{(total()*remise)| number : '1.2-2'}}</td>
              </tr>
              <tr class="nbreseance-row">
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal">Total Général </td>
                <td  [hidden]="this.pris==true" class="nbreseance-celltotal">{{total()-(total()*remise)| number : '1.2-2'}}</td>
                <td [hidden]="this.pris!=true" class="nbreseance-celltotal">{{0 | number : '1.2-2' }}</td>
                
              </tr>
              </ng-container>
            </table>
            <ng-container *ngIf=" this.assurtaux!=0&& selected.length!=0" >
    <span class="assurance"> Montant à payer : {{(total()-(total()*remise))*(1-assurtaux) | number : '1.2-2' }} Montant assuré : {{(total()-(total()*remise))*assurtaux | number : '1.2-2'}}</span>
    </ng-container>
    <br><br>
                  <div  *ngIf="formAdddossier.invalid">
                    <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                  </div>
              <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
             
             
         

        
            </form>

    </div>
    </div>
    </ng-template> 

    <ng-template #templateaddrendez>
      <div class="modal-header">
        <h4 class="modal-title pull-left"> Planifier un rendez-vous</h4>
        <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
          <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>
      </div>
      <div class="modal-body">
       
            
              <div class="c1">
                <form [formGroup]="formAddrendez" (ngSubmit)="addrendez()" >
                  <div class="row">
                <div class="col" >
                  <label class="labelmod" for="Nom">Date <span>*</span></label>
                  <input  class="input"   type="date" formControlName="DT" >
                </div>
                <div class="col" >
                  <label class="labelmod" >Heure<span>*</span> </label>
                  <input  class="input"   type="time" formControlName="HR" >
                 
                </div>
                  </div>
                  <div class="row">
                    
                    <div class="col" >
                      <label class="labelmod">Notes  </label>
                      <textarea formControlName="RM" cols="40" rows="5"></textarea>
                </div>
                    <div class="col" >
                  
                    </div>
          
                
                  </div>
                 
                 
          
          
    
                  <div  *ngIf="formAddrendez.invalid">
                    <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                  </div>
                  <input type="submit" [disabled]="buttondisable==true"  value="Ajouter">
                 
                 
             
    
            
                </form>
    
        </div>
        </div>
        </ng-template>  
    
        <ng-template #templatemodrendez>
          <div class="modal-header">
            <h4 class="modal-title pull-left"> Mettre à jour un rendez-vous</h4>
            <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
              <span aria-hidden="true" class="visually-hidden">&times;</span>
            </button>
          </div>
          <div class="modal-body">
           
                
                  <div class="c1">
                    <form [formGroup]="formAddrendez" (ngSubmit)="modrendez()" >
                      <div class="row">
                    <div class="col" >
                      <label class="labelmod" for="Nom">Date <span>*</span></label>
                      <input  class="input"   type="date" formControlName="DT" >
                    </div>
                    <div class="col" >
                      <label class="labelmod" >Heure<span>*</span> </label>
                      <input  class="input"   type="time" formControlName="HR" >
                     
                    </div>
                      </div>
                      <div class="row">
                        
                        <div class="col" >
                          <label class="labelmod">Notes  </label>
                          <textarea formControlName="RM" cols="40" rows="5"></textarea>
                    </div>
                        <div class="col" >
                          <label class="labelmod">État  </label>
                          <select    formControlName="ST" >
                            <option   value="En attente" >En attente</option>
                            <option  style="color: green;" value="Confirmé" >Confirmé</option>
                            <option  style="color: red;"  value="Annulé" >Annulé</option>

                          </select>
                        </div>
              
                    
                      </div>
                     
                     
              
              
        
                      <div  *ngIf="formAddrendez.invalid">
                        <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                      </div>
                      <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
                     
                     
                 
        
                
                    </form>
        
            </div>
            </div>
            </ng-template>  
            <ng-template #templateaddcons>
              <div class="modal-header">
                <h4 class="modal-title pull-left">Ajouter une nouvelle consultation</h4>
                <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
                  <span aria-hidden="true" class="visually-hidden">&times;</span>
                </button>
              </div>
              <div class="modal-body">
               
                    
                      <div class="c1">
                        <form [formGroup]="formAddcons" (ngSubmit)="addcons()" >
                          <div class="row">
                        <div class="col" >
                          <label class="labelmod" for="Nom">Date <span>*</span></label>
                          <input  class="input"   type="date" formControlName="CDATE" >
                        </div>
                        <div class="col" >
                          <label class="labelmod" >DIAGNOSTIQUE<span>*</span> </label>
                          <textarea formControlName="CDIAG" cols="40" rows="2"></textarea>
                         
                        </div>
                          </div>
                          <div class="row">
                            <div class="col" >
                              <label class="labelmod" >ATCD<span>*</span> </label>
                              <textarea formControlName="CATCD" cols="40" rows="2"></textarea>
                            </div>
                            <div class="col" >
                              <label class="labelmod" >HDM<span>*</span> </label>
                              <textarea formControlName="CHDM" cols="40" rows="7"></textarea>
                        </div>
                           
                  
                        
                          </div>
                         
                         
                  
                  
            
                          <div  *ngIf="formAddcons.invalid">
                            <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                          </div>
                          <input type="submit" [disabled]="buttondisable==true"  value="Ajouter">
                         
                         
                     
            
                    
                        </form>
            
                </div>
                </div>
                </ng-template>        
                <ng-template #templatemodcons>
                  <div class="modal-header">
                    <h4 class="modal-title pull-left"> Mettre à jour une consultation</h4>
                    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
                      <span aria-hidden="true" class="visually-hidden">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                   
                        
                          <div class="c1">
                            <form [formGroup]="formAddcons" (ngSubmit)="modcons()" >
                             
                             
                              <div class="row">
                                <div class="col" >
                                  <label class="labelmod" for="Nom">Date <span>*</span></label>
                                  <input  class="input"   type="date" formControlName="CDATE" >
                                </div>
                                <div class="col" >
                                  <label class="labelmod" >DIAGNOSTIQUE<span>*</span> </label>
                                  <textarea formControlName="CDIAG" cols="40" rows="2"></textarea>
                                 
                                </div>
                                  </div>
                                  <div class="row">
                                    <div class="col" >
                                      <label class="labelmod" >ATCD<span>*</span> </label>
                                      <textarea formControlName="CATCD" cols="40" rows="2"></textarea>
                                    </div>
                                    <div class="col" >
                                      <label class="labelmod" >HDM<span>*</span> </label>
                                      <textarea formControlName="CHDM" cols="40" rows="7"></textarea>
                                </div>
                                   
                          
                                
                                  </div>
                      
                
                              <div  *ngIf="formAddcons.invalid">
                                <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                              </div>
                              <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
                             
                             
                         
                
                        
                            </form>
                
                    </div>
                    </div>
                    </ng-template>  
<ng-template #templateadddoc>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Importer un nouveau document</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="c1">
    <form [formGroup]="formdoc" (ngSubmit)="docupload()" >
      <div class="row">
        <div class="col" >
      
          <input  class="inputrename"  type="text" formControlName="NM" placeholder="Nom ..">
    </div>  
      </div>
      <div class="row">
        <div class="col" >
      
          <input formControlName="FL" type="file"   (change)="onFileChange($event)">
    </div>  
      </div>
      <input  [disabled]="buttondisable==true" type="submit" value="Ajouter">

    </form>
  </div>
  </div>
</ng-template>

<ng-template #templatemoddoc>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Mettre à jour le nom d'un document.</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="c1">
    <form [formGroup]="formmoddoc" (ngSubmit)="renamedoc()" >
      <div class="row">
        <div class="col" >
      
          <input  class="inputrename"  type="text" formControlName="NM" placeholder="Nom ..">
    </div>  
      </div>
      
      <input [disabled]="buttondisable==true"  type="submit"  value="Renommer">

    </form>
  </div>
  </div>
</ng-template>

<dialog id="details">
  <div class="modal-header">
    <h4 class="modal-title pull-left">Séances et Paiements</h4>
    <button type="button" style="   border: none;" class="btn-close pull-right"  (click)="closed('#details')">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  
  <tabset  [justified]="true" >
         
    <tab id="seance" (selectTab)="selectseance()"   >   <ng-template  tabHeading>
      <span class="title">Les Séances </span>
    </ng-template>
<div class="btm"><br></div>
        
          <!-- <select    class="dropdown-toggle">
            <option  class="dropdown-item" ></option>
            <option class="dropdown-item">Masculin</option>
          </select> -->
                    
          
          <button *ngIf="!inchargementdetails" (click)="tempaddseance(templateaddseance)" class="btn btn-primary btn-circle btn-circle-sm m-1 " title="Ajouter"><i class="fa fa-plus "></i></button>
          <button *ngIf="!inchargementdetails" (click)="statseance()" class="btn btn-warning btn-circle btn-circle-sm m-1 " title="Statistique"><i class="fa fa-line-chart"></i></button>
          <div  *ngIf=" inchargementdetails" class="chargcontainer">
            <div class="image-container">
              <img [src]="charg"  >
            </div>
          </div> 
        <div *ngIf="!inchargementdetails" class="event-schedule-area-two bg-color ">

            <div class="container">
                
                <!-- row end-->
                <div class="row">
                    
                        
                        <div class="tab-content" id="myTabContent">
                        
                <br>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th class="text-center" scope="col">Date</th>
                                <th  scope="col">Détails</th>
                                <th scope="col">Actions</th>
                               
                                
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let seance of seances  | paginate: {id:'pagination', itemsPerPage: 20, currentPage: pages}" class="inner-box">
                                <th scope="row">
                                    <div class="event-date">
                                        
                                        <span>{{seance.sdate| date:'dd'}}-{{getMonthName(seance.sdate| date:'MM')}}-{{seance.sdate| date:'yyyy'}}</span>
                                        
                                    </div>
                                </th>
                                
                                <td>
                                  <ng-container *ngFor="let detail of seance.details; let i = index">
                                    <span class="badge badge-dot mr-4">
                                      <i class="bg-success"></i> {{ gettraitById(detail.split(',')[0]) }} [{{ detail.split(',')[1] }}]
                                    </span>
                                    <br>
                                    </ng-container>
                                
                                </td>
                                <td>
                                    <div class="primary-btn">
                                     
                                      <button id="editButton" [disabled]="seance.svalide && this.role!='superadmin'"  (click)="tempmodseance(templatemodseance,seance.sid)" class="btn btn-primary btn-circle btn-circle-sm m-1" title="Modifier"><i class="fa fa-edit"></i></button>
                                      <button id="deleteButton" [disabled]="seance.svalide && this.role!='superadmin'"  (click)="delseance(seance.sid)"  class="btn btn-danger btn-circle btn-circle-sm m-1" title="Supprimer"><i class="fa fa-trash"></i></button>
                                    </div>
                                </td>
                             
                            </tr>
                           
                        </tbody>
                    </table>
                    <pagination-controls id="pagination" (pageChange)=" pages = $event" previousLabel="" nextLabel="" class="page"></pagination-controls>

                </div>
                            </div>
                   
                       
                      
                    
                    <!-- /col end-->
                </div>
                <!-- /row end-->
            </div>
        </div>


    </tab>


<tab id="paie"  (selectTab)="selectpaie()" >   <ng-template  tabHeading>
      <span class="title">les Paiements </span>
    </ng-template>

<div class="btm"><br></div>
      

          <!-- <select    class="dropdown-toggle">
            <option  class="dropdown-item" ></option>
            <option class="dropdown-item">Masculin</option>
          </select> -->
                         <button  *ngIf="!inchargementdetails"  (click)="tempaddpaie(templateaddpaie)" class="btn btn-primary btn-circle btn-circle-sm m-1 " title="Ajouter"><i class="fa fa-plus "></i></button>
                         <button  *ngIf="!inchargementdetails" (click)="statpaie()" class="btn btn-warning btn-circle btn-circle-sm m-1 " title="Statistique"><i class="fa fa-line-chart"></i></button>
                         <div  *ngIf="inchargementdetails" class="chargcontainer">
                          <div class="image-container">
                            <img [src]="charg"  >
                          </div>
                        </div> 
        <div *ngIf="!inchargementdetails" class="event-schedule-area-two bg-color ">

            <div class="container">
                
                <!-- row end-->
                <div class="row">
                    
                        
                        <div class="tab-content" id="myTabContent">
                        
                <br>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th  class="text-center"   scope="col">Date</th>
                                <th  scope="col">Détails</th>
                                <th   scope="col">Actions</th>
                               
                                
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let paie of paiements  | paginate: {id:'pagination', itemsPerPage: 20, currentPage: pages}" class="inner-box">
                                <th scope="row">
                                    <div class="event-date">
                                        
                                        <span> {{paie.pdate| date:'dd'}}-{{getMonthName(paie.pdate| date:'MM')}}-{{paie.pdate| date:'yyyy'}}</span>
                                       
                                    </div>
                                </th>
                                
                                <td>
                                    <div class="event-wrap">
                                           
                                            <div class="categories">
                                                <a class="mnt"> {{paie.pmnt| number : '1.2-2'}} UM</a>
                                                <a class="mode">{{getmodeById(paie.pmode)}}</a>
                                            </div>
                                       
                                    </div>
                                </td>
                                <td>
                                    <div class="primary-btn">
                                     
                                      <button id="editButton" [disabled]="paie.pvalide && this.role!='superadmin'" (click)="tempmodpaie(templatemodpaie,paie.pid)" class="btn btn-primary btn-circle btn-circle-sm m-1" title="Modifier"><i class="fa fa-edit"></i></button>
                                      <button id="deleteButton" [disabled]="paie.pvalide && this.role!='superadmin'"  (click)="delpaie(paie.pid)"  class="btn btn-danger btn-circle btn-circle-sm m-1" title="Supprimer"><i class="fa fa-trash"></i></button>
                                    </div>
                                </td>
                             
                            </tr>
                           
                        </tbody>
                    </table>
                    <pagination-controls id="pagination" (pageChange)=" pages = $event" previousLabel="" nextLabel="" class="page"></pagination-controls>

                </div>
                            </div>
                   
                       
                      
                    
                    <!-- /col end-->
                </div>
                <!-- /row end-->
            </div>
        </div>

    </tab>



</tabset>    

</dialog>



<ng-template #templateaddseance>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Ajouter Seances</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="hideandopendialog()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
   
        
          <div class="c1">
            <form [formGroup]="formAddseance" (ngSubmit)="addseance()" >
              <div class="row">
            <div class="col" >
              <label class="labelmod" for="Nom">Date <span>*</span></label>
              <input  class="input"   type="date" formControlName="DT" >
            </div>
            <div class="col" >
              <label class="labelmod" >Traitement <span>*</span> </label>
              <ng-select class="custom"
              [items]="listraitinseance"
              bindLabel="name"
              placeholder="Sélectionner des traitements"
              appendTo="body"
              [multiple]="true"
              [closeOnSelect]="false"
[searchable]="false"
formControlName="SN"
(change)="onSelectionChange($event)">
             >
   </ng-select>
            </div>
              </div>
              <div class="row">
                
      
                <div class="col" >
                  <label class="labelmod">Notes  </label>
                  <textarea formControlName="NOTE" cols="10" rows="5"></textarea>
            </div>
            <div class="col" >
              <label class="labelmod" >Statut Paiement<span>*</span></label>
              <select  formControlName="SPAYER" >
                <option   value=false >Impayé</option>
                <option   value=true >Payé</option>
              </select>
            </div>
           
          </div>
         
             
      
      
             
        <br>
        
        <table class="nbreseance-table">
          <tr class="nbreseance-row">
            <th class="nbreseance-header">Traitement</th>
            <th class="nbreseance-header">Nbre séances</th>
          </tr>
          <tr class="nbreseance-row" *ngFor="let item of selected; let i = index">
            <td class="nbreseance-cell">{{ item.name }}</td>
            <td class="nbreseance-cell nbre">
              <input type="number" #nbreInput (input)="updateNbre(i, nbreInput.value)" value="{{ item.nbre }}">
            </td>
          </tr>
          

       
        </table>

              <div  *ngIf="formAddseance.invalid">
                <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
              </div>
              <input type="submit" [disabled]="buttondisable==true"  value="Ajouter">
             
             
         

        
            </form>

    </div>
    </div>
    </ng-template>  
    <ng-template #templatemodseance>
      <div class="modal-header">
        <h4 class="modal-title pull-left">Modifier Seances</h4>
        <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="hideandopendialog()">
          <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>
      </div>
      <div class="modal-body">
       
            
              <div class="c1">
                <form [formGroup]="formAddseance" (ngSubmit)="modseance()" >
                  <div class="row">
                    <div class="col" >
                      <label class="labelmod" for="Nom">Date <span>*</span></label>
                      <input  class="input"   type="date" formControlName="DT" >
                    </div>
                    <div class="col" >
                      <label class="labelmod" >Traitement <span>*</span> </label>
                      <ng-select class="custom"
                      [items]="listraitinseance"
                      bindLabel="name"
                      placeholder="Sélectionner des traitements"
                      appendTo="body"
                      [multiple]="true"
                      [closeOnSelect]="false"
        [searchable]="false"
        formControlName="SN"
        (change)="onSelectionChange($event)">
                     >
           </ng-select>
                    </div>
                      </div>
                      <div class="row">
                        
              
                        <div class="col" >
                          <label class="labelmod">Notes  </label>
                          <textarea formControlName="NOTE" cols="10" rows="5"></textarea>
                    </div>
                    <div class="col" >
                      <label class="labelmod" >Statut Paiement<span>*</span></label>
                      <select  formControlName="SPAYER" >
                        <option   value=false >Impayé</option>
                        <option   value=true >Payé</option>
                      </select>
                    </div>
                   
                  </div>
                 
                  <div class="row">
                        
              
               
                <div class="col" >
                  <label class="labelmod" >Validation <span>*</span></label>
                  <select  [attr.disabled]="this.role !== 'superadmin' ? true : null"  formControlName="SVALIDE" >
                    <option   value=false >Encours</option>
                    <option   value=true >Validé</option>
                  </select>
                </div>
                <div class="col" >
                    
                </div>
               
              </div>        
              
              
                     
                <br>
                
                <table class="nbreseance-table">
                  <tr class="nbreseance-row">
                    <th class="nbreseance-header">Traitement</th>
                    <th class="nbreseance-header">Nbre séances</th>
                  </tr>
                  <tr class="nbreseance-row" *ngFor="let item of selected; let i = index">
                    <td class="nbreseance-cell">{{ item.name }}</td>
                    <td class="nbreseance-cell nbre">
                      <input type="number" min="1" #nbreInput (input)="updateNbre(i, nbreInput.value)" value="{{ item.nbre }}">
                    </td>
                  </tr>
  
            </table>
    
                  <div  *ngIf="formAddseance.invalid">
                    <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                  </div>
                  <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
                 
                 
             
    
            
                </form>
    
        </div>
        </div>
        </ng-template>  

  <ng-template #templateaddpaie>
          <div class="modal-header">
            <h4 class="modal-title pull-left">Ajouter Paiement</h4>
            <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="hideandopendialog()">
              <span aria-hidden="true" class="visually-hidden">&times;</span>
            </button>
          </div>
          <div class="modal-body">
           
                
                  <div class="c1">
                    <form [formGroup]="formAddpaie" (ngSubmit)="addpaie()" >
                      <div class="row">
                    <div class="col" >
                      <label class="labelmod" for="Nom">Date <span>*</span></label>
                      <input  class="input"   type="date" formControlName="DT" >
                    </div>
                    <div class="col" >
                      <label class="labelmod" >Mode de paiement<span>*</span> </label>
                      <select    formControlName="MODE" >
                        <option *ngFor="let mode of modepaie"  value="{{mode.mpid}}">{{mode.mpnm}}</option>  
                      </select>
         
                    </div>
                      </div>
                      <div class="row">
                        <div class="col" >
                            <label class="labelmod" for="Nom">Montant <span>*</span></label>
                            <input  class="input"   type="number" formControlName="MNT" > 
                    </div>
                    <div class="col" >
                      <label class="labelmod">Notes  </label>
                      <textarea formControlName="NOTE" cols="10" rows="5"></textarea>
                    </div>
                   
                  </div>
                 
                     
              
              
                     
                <br>
                
           
        
                      <div  *ngIf="formAddpaie.invalid">
                        <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                      </div>
                      <input type="submit" [disabled]="buttondisable==true"  value="Ajouter">
                     
                     
                 
        
                
                    </form>
        
            </div>
            </div>
            </ng-template>  
  <ng-template #templatemodpaie>
    <div class="modal-header">
      <h4 class="modal-title pull-left">Modifier Paiement</h4>
      <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="hideandopendialog()">
        <span aria-hidden="true" class="visually-hidden">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      
          
            <div class="c1">
              <form [formGroup]="formAddpaie" (ngSubmit)="modpaie()" >
                <div class="row">
              <div class="col" >
                <label class="labelmod" for="Nom">Date <span>*</span></label>
                <input  class="input"   type="date" formControlName="DT" >
              </div>
              <div class="col" >
                <label class="labelmod" >Mode de paiement<span>*</span> </label>
                <select    formControlName="MODE" >
                  <option *ngFor="let mode of modepaie"  value="{{mode.mpid}}">{{mode.mpnm}}</option>
                </select>
    
              </div>
                </div>
                <div class="row">
                  
        
                  <div class="col" >
                      <label class="labelmod" for="Nom">Montant <span>*</span></label>
                      <input  class="input"   type="number" formControlName="MNT" >
              </div>
              <div class="col" >
                <label class="labelmod" >Validation <span>*</span></label>
                <select  [attr.disabled]="this.role !== 'superadmin' ? true : null"  formControlName="PVALIDE" >
                  <option   value=false >Encours</option>
                  <option   value=true >Validé</option>
                </select>
              </div>
             
              
            </div>
            
            <div class="row">
              <div class="col" >
                <label class="labelmod">Notes  </label>
                <textarea formControlName="NOTE" cols="10" rows="5"></textarea>
              </div>
              <div class="col" ></div>
              </div> 
        
        
                
          <br>
          
      
  
                <div  *ngIf="formAddpaie.invalid">
                  <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                </div>
                <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
                
                
            
  
          
              </form>
  
      </div>
      </div>
      </ng-template>  
                    
    <div class="modal fade" id="form" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    
          <div class="modal-content  px-md-4 p-sm-3 p-4">
          
         
            <a  (click)="closetempinforendez('form')"> <i class="fa fa-close"></i></a>
            <p class="r3 px-md-5 px-sm-1">{{ note ? note : 'aucune note' }}</p>
             
              
              
          </div>
      
  </div>
<!-- formseance -->
<dialog id="statseance">
  <div class="modal-header">
    <h4 class="modal-title pull-left">Statut du dossier </h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="closed('#statseance')">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
          <div class="c1">
            <div *ngFor="let item of seancesTraitsData">
              
              {{gettraitById(item.id)}} :   {{getTotalById(item.id)}}/{{item.nbre}}
            <div  class="progress">
            <div  class="progress-bar bg-success"
                   role="progressbar" [style.width.%]="(getTotalById(item.id)/ item.nbre)*100" 
                   aria-valuemin="0" aria-valuemax="100" [attr.title]=" ((getTotalById(item.id)/ item.nbre)*100  | number : '1.0-0' ) +'%'">
              </div>
            </div>
            <br>
            </div>
            </div>
            </div>

</dialog>

<dialog id="statpaie">
  <div class="modal-header">
    <h4 class="modal-title pull-left">Statut du dossier </h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="closed('#statpaie')">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
          <div class="c1">
         
              
            PAIEMENTS : {{this.paiements.totals}} UM/{{this.totaldossiermnt}} UM
            <div  class="progress">
            <div  class="progress-bar bg-success"
                   role="progressbar" [style.width.%]="(this.paiements.totals/ this.totaldossiermnt)*100" 
                   aria-valuemin="0" aria-valuemax="100" [attr.title]=" ((this.paiements.totals/ this.totaldossiermnt)*100 | number : '1.0-0' )  +'%'">
              </div>
            </div>
            <br>
            </div>
            </div>
          

</dialog>


     </body>
     <dialog id="invoice">
      <div class="modal-header">
        <h4 class="modal-title pull-left">Dossier Infos :  </h4>
        <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="closed('#invoice')">
          <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>
      </div>
      <section class="py-3 py-md-5">
        <div class="row">
          <div class="col-12 text-end">
            <button (click)="printinvoice('btninvoice')" class="btn btn-primary mb-3 impr">Imprimer</button>
            <button  *ngIf=" this.role=='superadmin'&& dossierinfo?.dvalide!=true" id="editButton" (click)="validedossier(dossierinfo?.did)" class="btn btn-success  mb-3 vald "><i class="fa fa-check"></i></button>

            
          </div>
        </div>
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-12 col-lg-9 col-xl-9 col-xxl-9">
              <div class="row gy-3 mb-3">
                <div class="col-6">
                  <h2 class="text-uppercase text-endx m-0">Facture</h2>
                </div>
                <div class="col-6">
                  <a class="d-block text-end" href="#!">
                    <img src="{{logo}}" class="img-fluid" width="135" height="44">
                  </a>
                </div>
                <div class="col-12">
                  <h5>patient : </h5>
                  <address>
                    <strong>Nom : {{this.infospat?.pnom}}</strong><br>
                    Téléphone : {{this.infospat?.ptel}} <br>
                    Date Naissance : {{this.infospat?.pnai | date:'dd-MM-yyyy'}}<br>
                  </address>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-12 col-sm-6 col-md-6">
                  
                  <address>
                    Numéro Dossier : {{dossierinfo?.did}}<br>
                    <strong>Date :{{dossierinfo?.ddate| date:'dd-MM-yyyy'}} </strong><br>
                    Remise : {{dossierinfo?.dremise}} % <br>
                  
                    Montant à payer : {{dossierinfo?.dclmnt | number : '1.2-2'}} UM<br>
                    
                  </address>
                </div>
                <div class="col-12 col-sm-6 col-md-6">
                 
                  <h5 *ngIf="dossierinfo?.dassur"  >Détails de l'Assurance</h5>
                  <address *ngIf="dossierinfo?.dassur">
                    {{getassurname(dossierinfo?.dassurid)}}<br>
                    <strong>Taux de couverture : {{dossierinfo?.dassurtaux}} % </strong><br>
                    Montant assuré : {{dossierinfo?.dassurmnt | number : '1.2-2'}}  UM<br>
                    
                  </address>
                  <!-- <div class="row" *ngIf="dossierinfo?.dassur" >
                    <span class="col-6">{{getassurname(dossierinfo?.dassurid)}}</span>
                    <span class="col-6 text-sm-end"></span>
                    <span class="col-6">Taux de couverture :</span>
                    <span class="col-6 text-sm-end">{{dossierinfo?.dassurtaux}} %</span>
                    <span class="col-6">Montant assuré:</span>
                    <span class="col-6 text-sm-end">{{dossierinfo?.dassurmnt | number : '1.2-2'}} UM</span>
                    
                  </div> -->
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-12">
                  <div class="table-responsive">
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th scope="col" class="text-uppercase">Traitement</th>
                          <th scope="col" class="text-uppercase">Tarif</th>
                          <th scope="col" class="text-uppercase text-end">Nbre séances</th>
                          <th scope="col" class="text-uppercase text-end">Total</th>
                        </tr>
                      </thead>
                      <tbody class="table-group-divider">
                        <tr *ngFor="let detail of dossierinfo?.details; let i = index">
                          <th scope="row">{{ gettraitById(detail.split(',')[0]) }}</th>
                          <td>{{detail.split(',')[1]}}</td>
                          <td class="text-end">{{ detail.split(',')[2] }}</td>
                          <td class="text-end">{{ detail.split(',')[1] * detail.split(',')[2] }}</td>
                        </tr>
                
                        <tr>
                          <td colspan="3" class="text-end">Total</td>
                          <td class="text-end">{{dossierinfo?.dmntbr | number : '1.2-2'}} UM</td>
                        </tr>
                        <tr>
                          <td colspan="3" class="text-end">Remise </td>
                          <td class="text-end">{{(dossierinfo?.dmntbr * (dossierinfo?.dremise/100) )| number : '1.2-2'}} UM</td>
                        </tr>
                       
                        <tr>
                          <th scope="row" colspan="3" class="text-uppercase text-end">Total Général</th>
                          <td class="text-end">{{dossierinfo?.dmntar | number : '1.2-2'}} UM</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
             
            </div>
          </div>
        </div>
      </section>
      
        </dialog>


        <dialog id="invoicecons">
          <div class="modal-header">
            <h4 class="modal-title pull-left">Consultation Infos :  </h4>
            <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="closed('#invoicecons')">
              <span aria-hidden="true" class="visually-hidden">&times;</span>
            </button>
          </div>
          <section class="py-3 py-md-5">
            <div class="row">
              <div class="col-12 text-end">
                <button (click)="printinvoice('btncons')" class="btn btn-primary mb-3 impr">Imprimer</button>
           
    
                
              </div>
            </div>
            <div class="container">
              <div class="row justify-content-center">
                <div class="col-12 col-lg-9 col-xl-9 col-xxl-9">
                  <div class="row gy-3 mb-3">
                    <div class="col-8">
                      <h2 class="text-uppercase text-endx m-0">Jemila Centre de Kinesitherapie</h2>
                    </div>
                    <div class="col-4">
                      <a class="d-block text-end" href="#!">
                        <img src="{{logo}}" class="img-fluid" width="135" height="44">
                      </a>
                    </div>
                    <div class="col-12">
                      <h5>patient : </h5>
                      <address>
                        <strong>Nom : {{this.infospat?.pnom}}</strong><br>
                        Téléphone : {{this.infospat?.ptel}} <br>
                        Date Naissance : {{this.infospat?.pnai | date:'dd-MM-yyyy'}}<br>
                        Date Consultation : {{this.consinfo?.cdate | date:'dd-MM-yyyy'}}<br>
                      </address>
                    </div>
                  </div>
                  
                 
                    <div class="col-12">
                     <span style="color:grey"> DIAGNOSTIQUE   </span><br>{{this.consinfo?.cdiag}}<br><br>
                    <span style="color:grey"> ATCD  </span><br> {{this.consinfo?.catcd}} <br><br>
                  <span style="color:grey"> HDM  </span><br> {{this.consinfo?.chdm}}<br>
                    </div>
                
                 
                </div>
              </div>
            </div>
          </section>
          
            </dialog>     
 </html>
 