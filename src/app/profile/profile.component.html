<html>
    
    <body  id="body-pd">
        <header class="header" id="header">
            <div class="header_toggle"> <i class='bx bx-menu' (click)="toggleNavbar()" id="header-toggle"></i> </div>
			
           <div class="header_user">
        <div class="header_text">Meden Belkasem</div>
        <div class="header_img"> <img src="https://i.imgur.com/hczKIze.jpg" alt=""> </div>
    </div>
        </header>

        <div class="l-navbar" id="nav-bar">
            <nav class="nav">
                <div> 
                    <a href="#" class="nav_logo"> 
                        <i class='bx bx-layer nav_logo-icon'></i> 
                        <span class="nav_logo-name">CKRF</span> 
                    </a>
                    <div class="nav_list"> 
                       
                        <a href="#" class="nav_link active"> 
                            <i class='bx bx-user nav_icon'></i> 
                            <span class="nav_name">Patients</span> 
                        </a> 
                        <a href="#" class="nav_link"> 
                            <i class='bx bx-calendar nav_icon'></i> 
                            <span class="nav_name">Rendez-Vous</span> 
                        </a> 
                        <a href="#" class="nav_link"> 
                            <i class='bx bx-calculator nav_icon'></i> 
                            <span class="nav_name">Comptabilité</span> 
                        </a> 
                        
                        <a href="#" class="nav_link"> 
                            <i class='bx bx-bar-chart-alt-2 nav_icon'></i> 
                            <span class="nav_name">Statistique</span> 
                        </a> 
                        <a href="#" class="nav_link "> 
                          <i class='bx bx-grid-alt nav_icon'></i> 
                          <span class="nav_name">RH</span> 
                      </a> 
                        <a href="#" class="nav_link"> 
                          <i class='bx bx-certification nav_icon'></i> 
                          <span class="nav_name">Administration</span> 
                      </a> 
                    </div>
                </div> 
                <a href="#" class="nav_link"> 
                    <i class='bx bx-log-out nav_icon'></i> 
                    <span class="nav_name">Déconnexion</span> 
                </a>
            </nav>
        </div>

        <div class="height-100 bg-light">
            <div class="container">
            <div class="main-body">
 <div class="row gutters-sm">
            <div class="col-md-4 mb-3">
              <div class="card">
                <div class="card-body">
                  <div class="d-flex flex-column align-items-center text-center">
                    <div class="containerimg">
                    <img src="{{imgurl}}" onerror="this.src='assets/profiles/defaut.png'" alt="Admin" class="rounded-circle" width="180" height="150">
                    <div class="text-overlay" (click)="tempmodifierimg(templateimg)">Changer la photo</div>
                  </div>
                    <div class="mt-3">
                      <h5>{{this.infospat?.pnom}}</h5>
                        <i  *ngIf="patst=='encours'" style="font-size: 2em;color:green" class='bx bx-check-circle nav_icon'></i> 
                        <i  *ngIf="patst!='encours'" style="font-size: 2em;color:red" class='bx bx-check-circle nav_icon'></i> 

                        <p class="text-muted "></p>
                      <div class="button-container">
                      <button (click)="tempmodifierpatien(templatemodifpatien)" class="btn btn-primary">Modifier</button>
                      <button *ngIf="patst=='encours'" (click)="activer('inactif')" class="btn btn-outline-primary">Désactiver</button>
                      <button *ngIf="patst!='encours'" (click)="activer('actif')" class="btn btn-outline-primary">Activer</button>
                    </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
            <div class="col-md-8">
              <div class="card mb-3">
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Numéro Téléphone 
                      </h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      {{this.infospat?.ptel}}
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Date Naissance</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      {{this.infospat?.pnai | date:'dd-MM-yyyy'}}
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Genre </h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      {{this.infospat?.pgnr}}
                    </div>
                  </div>
                  <hr>
                 
                 
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Adresse</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      {{this.infospat?.padrss}}
                    </div>
                  </div>
                  
                  <hr>

                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Date D'ajout</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      {{this.infospat?.pdaj | date:'dd-MM-yyyy'}}
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-12">
                      <a class="btn btn-danger" (click)="supprimerpatient()">Supprimer</a>
                    </div>
                  </div>
                  
                </div>
              </div>


        </div>
    </div>
    <div class="container ">
        <!-- For demo purpose -->
        
        <div class="p-5 bg-white rounded shadow mb-5">
          <!-- Lined tabs-->
          <ul id="myTab2" role="tablist" class="nav nav-tabs nav-pills with-arrow lined flex-column flex-sm-row text-center">
            <li class="nav-item flex-sm-fill">
              <a id="dossier" data-toggle="tab" (click)="showTab('dossier',true)" role="tab" aria-controls="home2" aria-selected="false"  class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0 active">Dossiers Médicaux </a>
            </li>
            <li class="nav-item flex-sm-fill">
              <a id="rendezvous" data-toggle="tab" (click)="showTab('rendezvous',true)" role="tab" aria-controls="profile2" aria-selected="true"  class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0 "> Rendez Vous</a>
            </li>
            <li class="nav-item flex-sm-fill">
              <a id="documents" data-toggle="tab" (click)="showTab('documents',true)" role="tab" aria-controls="contact2" aria-selected="false"  class="nav-link text-uppercase font-weight-bold rounded-0">Documents</a>
            </li>
          </ul>
          <div id="myTab2Content" class="tab-content">
            <div id="dossier" role="tabpanel" aria-labelledby="home-tab" class="tab-pane fade show active  ">
              <button (click)="tempadddossier(templateadddossier)" class="btn btn-primary new"><i class="fa fa-plus"></i> Ajouter un dossier</button>
              <div class="container">
                <div class="row">
                    <div class="col-lg-4"  *ngFor="let dos of dossiers">
                        <div class="card card-margin">
                            <div class="card-header no-border">
                               
                            </div>
                            <div class="card-body pt-0">
                                <div class="widget-49">
                                    <div class="widget-49-title-wrapper">
                                        <div class="widget-49-date-primary">
                                            <span class="widget-49-date-month">{{dos.ddate| date:'dd'}}</span>
                                            <span class="widget-49-date-month2">{{getMonthName(dos.ddate| date:'MM')}}</span>
                                            <span class="widget-49-date-month">{{dos.ddate| date:'yyyy'}}</span>
                                        </div>
                                        <div class="widget-49-meeting-info">
                                            <span class="widget-49-pro-title">Remise : {{dos.dremise}}%</span>
                                            <span class="widget-49-meeting-time">Total : {{dos.dmntar}} UM</span>
                                            <span *ngIf="dos.dassur" style="color: green;" class="widget-49-meeting-time">Assuré : {{dos.dassurtaux}}%</span>
                                            <span *ngIf="!dos.dassur" style="color:red"  class="widget-49-meeting-time">Non Assuré</span>
                                            <span class="widget-49-meeting-time">Montant à payer : {{dos.dclmnt}} UM</span>
                                          </div>
                                    </div>
                                    <ol  class="widget-49-meeting-points">
                                        <li *ngFor="let detail of dos.details; let i = index" class="widget-49-meeting-item"><span>{{ gettraitById(detail.split(',')[0]) }} [{{ detail.split(',')[2] }}]</span></li>
                                    </ol>
                                    <div class="widget-49-meeting-action">
                                      <div class="btn-group">
                                        <button id="editButton" (click)="tempmoddossier(templatemoddossier,dos.did)" class="btn btn-primary btn-circle btn-circle-sm m-1" title="Modifier"><i class="fa fa-edit"></i></button>
                                        <button id="deleteButton" (click)="deldossier(dos.did)" class="btn btn-danger btn-circle btn-circle-sm m-1" title="Supprimer"><i class="fa fa-trash"></i></button>
                                      </div>
                                      <button id="deleteButton" (click)="tempinforendez(dos.dnote)"class="btn btn-info btn-circle btn-circle-sm m-1" title="Info"><i class="fa fa-info"></i></button>

                                        <a (click)="tempdetails(dos.did)"  class="btn btn-sm btn-flash-border-primary">détails</a>
 
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                
                </div>
                </div>
                      
              
         
       
            </div>
            <div id="rendezvous" role="tabpanel" aria-labelledby="profile-tab" class="tab-pane fade   ">
              
             
		
              <div class="event-schedule-area-two bg-color ">
              
                <div class="container">
                    
                    <!-- row end-->
                    <div class="row">
                        
                            
                            <div class="tab-content" id="myTabContent">
                              <button (click)="tempaddrendez(templateaddrendez)" class="btn btn-primary new"><i class="fa fa-plus"></i> Planifier un rendez-vous</button>
                    <br>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th class="text-center" scope="col">Date</th>
                                                  
                                                    <th scope="col">État</th>
                                                  
                                                    <th  scope="col">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let ev of events | paginate: {id:'pagination', itemsPerPage: 10, currentPage: pages}" class="inner-box">
                                                    <th scope="row">
                                                        <div class="event-date">
                                                            <span>{{ev.edate| date:'dd'}}-{{getMonthName(ev.edate| date:'MM')}}-{{ ev.etime | slice: 0:5 }}</span>
                                                           
                                                        </div>
                                                    </th>
                                                   
                                                   
                                                       
                                                    <td>
                                                        <div class="r-no">
                                                          <span [style.color]="getColorByStatus(ev.estat)">
                                                            {{ ev.estat }}
                                                        </span>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="primary-btn">
                                                          <button id="deleteButton" (click)="tempinforendez(ev.enote)"class="btn btn-info btn-circle btn-circle-sm m-1" title="Info"><i class="fa fa-info"></i></button>
                                                          <button id="editButton" (click)="tempmodrendez(templatemodrendez,ev.eid)" class="btn btn-primary btn-circle btn-circle-sm m-1" title="Modifier"><i class="fa fa-edit"></i></button>
                                                          <button id="deleteButton" (click)="delrendezvous(ev.eid)" class="btn btn-danger btn-circle btn-circle-sm m-1" title="Supprimer"><i class="fa fa-trash"></i></button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                
                                            </tbody>
                                        </table>
                                        <pagination-controls id="pagination" (pageChange)=" pages = $event" previousLabel="" nextLabel="" class="page"></pagination-controls>

                                    </div>
                                </div>
                       
                           
                          
                        
                        <!-- /col end-->
                    </div>
                    <!-- /row end-->
                </div>
            </div>
              
              
            </div>
            <div id="documents" role="tabpanel" aria-labelledby="contact-tab" class="tab-pane fade  ">
              <div class="container flex-grow-1 light-style container-p-y">
          <div class="container-m-nx container-m-ny bg-lightest mb-3">
              
            <button (click)="tempadddoc(templateadddoc)" class="btn btn-primary new"><i class="fa fa-plus"></i> Importer un nouveau document</button>
      
              <hr class="m-0" />
          </div>
      
          <div class="file-manager-container file-manager-col-view">
              
      
             
      
              
      
              
              <div class="file-item" *ngFor="let file of listfiles | paginate: {id:'pagination', itemsPerPage: 10, currentPage: pagesfile}">
                  <div class="file-item-select-bg bg-primary"></div>
                  <label class="file-item-checkbox custom-control custom-checkbox">
                    
                      <span class="custom-control-label"></span>
                  </label>
                  <div class="file-item-icon fa fa-file-pdf-o text-secondary"></div>
                  <a (click)="downloadfile(file.name)"  class="file-item-name">
                     {{file.name}}
                  </a>
                  <a   class="file-item-date">
                    {{file.creationDate | date:'dd-MM-yyyy'}}
                 </a>
                  <div class="file-item-changed"> </div>
                  <div class="btn-group">
          <button id="editButton" (click)="tempmoddoc(templatemoddoc,file.name)"  class="btn btn-primary btn-circle btn-circle-sm m-1" title="Edit"><i class="fa fa-edit"></i></button>
          <button id="deleteButton"  (click)="deletedoc(file.name)" class="btn btn-danger btn-circle btn-circle-sm m-1" title="Delete"><i class="fa fa-trash"></i></button>
        </div>
              </div>
      
            

             
      
              
      
              
      
              
          </div>
          <pagination-controls id="pagination" (pageChange)=" pagesfile = $event" previousLabel="Précédente" nextLabel="Suivante" class="page"></pagination-controls>

      </div>
            </div>
          </div>
          <!-- End lined tabs -->
         
        </div>
      
      </div>


                </div>
                </div>
                </div>
         <!--Container Main end-->
         <ng-template #templatemodifpatien>
          <div class="modal-header">
            <h4 class="modal-title pull-left">Éditer les informations du patient</h4>
            <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
              <span aria-hidden="true" class="visually-hidden">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="c1">
              <form [formGroup]="formAddpatient" (ngSubmit)="modpatient()" >
                <div class="row">
              <div class="col" >
                <label class="labelmod" for="Nom">Nom /Prénom <span>*</span></label>
                <input  class="input" maxlength="30"  type="text" formControlName="Nom" placeholder="Nom / Prénom ..">
              </div>
              <div class="col" >
                <label class="labelmod" for="TL">Telephone <span>*</span> </label>
            <input  class="input" type="number" formControlName="TL" placeholder="Telephone ..">
               
              </div>
                </div>
                <div class="row">
                  <div class="col" >
                    <label class="labelmod" >Genre <span>*</span></label>
                    <select    formControlName="GNR" >
                      <option   value="Masculin" >Masculin</option>
                      <option   value="Féminin" >Féminin</option>
                    </select>
                  </div>

                  <div class="col" >
                <label class="labelmod" for="DN">Date Naissance <span>*</span></label>
                <input   type="DATE"  formControlName="DN" placeholder="Date Naissance..">
              </div>
              
                </div>
          
                <div class="row">
                  <div class="col" >
                    <label class="labelmod" for="Nom">Adresse <span>*</span></label>
                    <input  class="input"   type="text" formControlName="ADRS" placeholder="Adresse ..">
              </div>
              <div class="col" >
                
              </div>
                </div>
      
      
      
               
          
                <div  *ngIf="formAddpatient.invalid">
                  <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                </div>
          
                <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
          
              </form>
            </div>
            </div>
            </ng-template>    
            
            
            <!-- image profile-->
<ng-template #templateimg>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Mettre à jour la photo du patient</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="c1">
    <form [formGroup]="formimg" (ngSubmit)="imgupload()" >
      <div class="row">
        <div class="col" >
      
          <input formControlName="IMG" type="file"   (change)="onFileChange($event)">
    </div>  
      </div>
      <input  [disabled]="buttondisable==true" type="submit" value="Changer">

    </form>
  </div>
  </div>
</ng-template>

<ng-template #templateadddossier>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Ajouter un dossier</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
   
        
          <div class="c1">
            <form [formGroup]="formAdddossier" (ngSubmit)="adddossier()" >
              <div class="row">
            <div class="col" >
              <label class="labelmod" for="Nom">Date <span>*</span></label>
              <input  class="input"   type="date" formControlName="DT" >
            </div>
            <div class="col" >
              <label class="labelmod" > Remise<span>*</span> </label>
              <input  formControlName="RMS"  (change)="tauxremisechange($event)" type="number" min="0" max="100" value=0>
             
            </div>
              </div>
              <div class="row">
                <div class="col" >
                  <label class="labelmod" >Traitement<span>*</span> </label>
                  <ng-select class="custom"
                  [items]="listraitinseance"
                  bindLabel="name"
                  placeholder="Sélectionner des traitements"
                  appendTo="body"
                  [multiple]="true"
                  [closeOnSelect]="false"
    [searchable]="false"
    formControlName="TR"
    (change)="onSelectionChange2($event)">
                 >
                </ng-select>
                </div>
      
              
                <div class="col">
                  <label class="labelmod" > Couverture D'Assurance</label>
                  <select (change)="tauxchange($event)"   formControlName="ASSRID" >
                    <option   value="0" > Non assuré</option>
                    <option *ngFor="let assr of assurs"  value="{{assr.asid}}">{{assr.asnm}}</option>  
                  </select>

                </div>
              </div>

              <div class="row">
               
              
                <div class="col" >
                  <label class="labelmod" >Le taux de couverture</label>
                  <input (change)="tauxassurchange($event)" type="number"  min="0" max="100" value="0" formControlName="ASSRTAUX" >
                </div>
                <div class="col" >
                  <label class="labelmod">Notes </label>
                  <textarea formControlName="NOTE" cols="40" rows="5"></textarea>
            </div>
                </div>
             
               
      
      
             
        <br>
        
        <table class="nbreseance-table">
          <tr class="nbreseance-row">
            <th class="nbreseance-header">Traitement</th>
            <th class="nbreseance-header">Tarif</th>
            <th class="nbreseance-header">Nbre séances</th>
            <th class="nbreseance-header">Total</th>
          </tr>
          <tr class="nbreseance-row" *ngFor="let item of selected; let i = index">
            <td class="nbreseance-cell">{{ item.name }}</td>
            <td class="nbreseance-cell nbre">
              <input type="number" #prixInput (input)="updateprix(i, prixInput.value)" value="{{ item.prix }}">
            </td>
            <td class="nbreseance-cell nbre">
              <input type="number" #nbreInput (input)="updateNbre(i, nbreInput.value)" value="{{ item.nbre }}">
            </td>
            <td class="nbreseance-cell nbre">
              <input type="number" readonly value="{{ item.prix *item.nbre }}">
            </td>
          </tr>
          <ng-container *ngIf="selected.length!=0">
          <tr class="nbreseance-row">
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal">Total</td>
            <td class="nbreseance-celltotal">{{total()| number : '1.2-2'}}</td>
          </tr>
          <tr class="nbreseance-row">
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal">Remise ({{remise*100}}%)</td>
            <td class="nbreseance-celltotal">{{(total()*remise)| number : '1.2-2'}}</td>
          </tr>
          <tr class="nbreseance-row">
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal"></td>
            <td class="nbreseance-celltotal">Total Général </td>
            <td class="nbreseance-celltotal">{{total()-(total()*remise)}}</td>
          </tr>
          </ng-container>
        </table>
        <ng-container *ngIf=" this.assurtaux!=0&& selected.length!=0" >
<span class="assurance"> Montant à payer : {{(total()-(total()*remise))*(1-assurtaux) | number : '1.2-2' }} Montant assuré : {{(total()-(total()*remise))*assurtaux | number : '1.2-2'}}</span>
</ng-container>
<br><br>
              <div  *ngIf="formAdddossier.invalid">
                <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
              </div>
              <input type="submit" [disabled]="buttondisable==true"  value="Ajouter">
             
             
         

        
            </form>

    </div>
    </div>
    </ng-template>  

    
<ng-template #templatemoddossier>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Mettre à jour un dossier</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
   
        
          <div class="c1">
            <form [formGroup]="formAdddossier" (ngSubmit)="moddossier()" >
              <div class="row">
                <div class="col" >
                  <label class="labelmod" for="Nom">Date <span>*</span></label>
                  <input  class="input"   type="date" formControlName="DT" >
                </div>
                <div class="col" >
                  <label class="labelmod" > Remise<span>*</span> </label>
                  <input  formControlName="RMS"  (change)="tauxremisechange($event)" type="number" min="0" max="100" value=0>
                 
                </div>
                  </div>
                  <div class="row">
                    <div class="col" >
                      <label class="labelmod" >Traitement<span>*</span> </label>
                      <ng-select class="custom"
                      [items]="listraitinseance"
                      bindLabel="name"
                      placeholder="Sélectionner des traitements"
                      appendTo="body"
                      [multiple]="true"
                      [closeOnSelect]="false"
        [searchable]="false"
        formControlName="TR"
        (change)="onSelectionChange2($event)">
                     >
                    </ng-select>
                    </div>
          
                  
                    <div class="col">
                      <label class="labelmod" > Couverture D'Assurance</label>
                      <select (change)="tauxchange($event)"   formControlName="ASSRID" >
                        <option   value="0" > Non assuré</option>
                        <option *ngFor="let assr of assurs"  value="{{assr.asid}}">{{assr.asnm}}</option>  
                      </select>
    
                    </div>
                  </div>
    
                  <div class="row">
                   
                  
                    <div class="col" >
                      <label class="labelmod" >Le taux de couverture</label>
                      <input (change)="tauxassurchange($event)" type="number"  min="0" max="100" value="0" formControlName="ASSRTAUX" >
                    </div>
                    <div class="col" >
                      <label class="labelmod">Notes </label>
                      <textarea formControlName="NOTE" cols="40" rows="5"></textarea>
                </div>
                    </div>
                 
                   
          
          
                 
            <br>
            
            <table class="nbreseance-table">
              <tr class="nbreseance-row">
                <th class="nbreseance-header">Traitement</th>
                <th class="nbreseance-header">Tarif</th>
                <th class="nbreseance-header">Nbre séances</th>
                <th class="nbreseance-header">Total</th>
              </tr>
              <tr class="nbreseance-row" *ngFor="let item of selected; let i = index">
                <td class="nbreseance-cell">{{ item.name }}</td>
                <td class="nbreseance-cell nbre">
                  <input type="number" #prixInput (input)="updateprix(i, prixInput.value)" value="{{ item.prix }}">
                </td>
                <td class="nbreseance-cell nbre">
                  <input type="number" #nbreInput (input)="updateNbre(i, nbreInput.value)" value="{{ item.nbre }}">
                </td>
                <td class="nbreseance-cell nbre">
                  <input type="number" readonly value="{{ item.prix *item.nbre }}">
                </td>
              </tr>
              <ng-container *ngIf="selected.length!=0">
              <tr class="nbreseance-row">
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal">Total</td>
                <td class="nbreseance-celltotal">{{total()| number : '1.2-2'}}</td>
              </tr>
              <tr class="nbreseance-row">
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal">Remise ({{remise*100}}%)</td>
                <td class="nbreseance-celltotal">{{(total()*remise)| number : '1.2-2'}}</td>
              </tr>
              <tr class="nbreseance-row">
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal"></td>
                <td class="nbreseance-celltotal">Total Général </td>
                <td class="nbreseance-celltotal">{{total()-(total()*remise)}}</td>
              </tr>
              </ng-container>
            </table>
            <ng-container *ngIf=" this.assurtaux!=0&& selected.length!=0" >
    <span class="assurance"> Montant à payer : {{(total()-(total()*remise))*(1-assurtaux) | number : '1.2-2' }} Montant assuré : {{(total()-(total()*remise))*assurtaux | number : '1.2-2'}}</span>
    </ng-container>
    <br><br>
                  <div  *ngIf="formAdddossier.invalid">
                    <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                  </div>
              <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
             
             
         

        
            </form>

    </div>
    </div>
    </ng-template> 

    <ng-template #templateaddrendez>
      <div class="modal-header">
        <h4 class="modal-title pull-left"> Planifier un rendez-vous</h4>
        <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
          <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>
      </div>
      <div class="modal-body">
       
            
              <div class="c1">
                <form [formGroup]="formAddrendez" (ngSubmit)="addrendez()" >
                  <div class="row">
                <div class="col" >
                  <label class="labelmod" for="Nom">Date <span>*</span></label>
                  <input  class="input"   type="date" formControlName="DT" >
                </div>
                <div class="col" >
                  <label class="labelmod" >Heure<span>*</span> </label>
                  <input  class="input"   type="time" formControlName="HR" >
                 
                </div>
                  </div>
                  <div class="row">
                    
                    <div class="col" >
                      <label class="labelmod">Notes  </label>
                      <textarea formControlName="RM" cols="40" rows="5"></textarea>
                </div>
                    <div class="col" >
                  
                    </div>
          
                
                  </div>
                 
                 
          
          
    
                  <div  *ngIf="formAddrendez.invalid">
                    <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                  </div>
                  <input type="submit" [disabled]="buttondisable==true"  value="Ajouter">
                 
                 
             
    
            
                </form>
    
        </div>
        </div>
        </ng-template>  
    
        <ng-template #templatemodrendez>
          <div class="modal-header">
            <h4 class="modal-title pull-left"> Mettre à jour un rendez-vous</h4>
            <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
              <span aria-hidden="true" class="visually-hidden">&times;</span>
            </button>
          </div>
          <div class="modal-body">
           
                
                  <div class="c1">
                    <form [formGroup]="formAddrendez" (ngSubmit)="modrendez()" >
                      <div class="row">
                    <div class="col" >
                      <label class="labelmod" for="Nom">Date <span>*</span></label>
                      <input  class="input"   type="date" formControlName="DT" >
                    </div>
                    <div class="col" >
                      <label class="labelmod" >Heure<span>*</span> </label>
                      <input  class="input"   type="time" formControlName="HR" >
                     
                    </div>
                      </div>
                      <div class="row">
                        
                        <div class="col" >
                          <label class="labelmod">Notes  </label>
                          <textarea formControlName="RM" cols="40" rows="5"></textarea>
                    </div>
                        <div class="col" >
                          <label class="labelmod">État  </label>
                          <select    formControlName="ST" >
                            <option   value="En attente" >En attente</option>
                            <option  style="color: green;" value="Confirmé" >Confirmé</option>
                            <option  style="color: red;"  value="Annulé" >Annulé</option>

                          </select>
                        </div>
              
                    
                      </div>
                     
                     
              
              
        
                      <div  *ngIf="formAddrendez.invalid">
                        <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                      </div>
                      <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
                     
                     
                 
        
                
                    </form>
        
            </div>
            </div>
            </ng-template>  
        
             
<ng-template #templateadddoc>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Importer un nouveau document</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="c1">
    <form [formGroup]="formdoc" (ngSubmit)="docupload()" >
      <div class="row">
        <div class="col" >
      
          <input  class="inputrename"  type="text" formControlName="NM" placeholder="Nom ..">
    </div>  
      </div>
      <div class="row">
        <div class="col" >
      
          <input formControlName="FL" type="file"   (change)="onFileChange($event)">
    </div>  
      </div>
      <input  [disabled]="buttondisable==true" type="submit" value="Ajouter">

    </form>
  </div>
  </div>
</ng-template>

<ng-template #templatemoddoc>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Mettre à jour le nom d'un document.</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="c1">
    <form [formGroup]="formmoddoc" (ngSubmit)="renamedoc()" >
      <div class="row">
        <div class="col" >
      
          <input  class="inputrename"  type="text" formControlName="NM" placeholder="Nom ..">
    </div>  
      </div>
      
      <input [disabled]="buttondisable==true"  type="submit"  value="Renommer">

    </form>
  </div>
  </div>
</ng-template>

<dialog id="details">
  <div class="modal-header">
    <h4 class="modal-title pull-left">Séances et Paiements</h4>
    <button type="button" style="   border: none;" class="btn-close pull-right"  (click)="closed('#details')">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  
    <div class="height-100 ">
      <div class="btm"><br></div>
     
      <div class="container ">
          <!-- For demo purpose -->
          
          <div class="p-5 bg-white rounded shadow mb-5">
            <!-- Lined tabs-->
            <ul id="myTab2" role="tablist" class="nav nav-tabs nav-pills with-arrow lined flex-column flex-sm-row text-center">
              <li class="nav-item flex-sm-fill">
                <a id="seances" data-toggle="tab" (click)="showTab('seances',false)" role="tab" aria-controls="home2" aria-selected="false"  class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0 active">Les Séances</a>
              </li>
              <li class="nav-item flex-sm-fill">
                <a id="paiements" data-toggle="tab" (click)="showTab('paiements',false)" role="tab" aria-controls="profile2" aria-selected="true"  class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0 ">les Paiements</a>
              </li>
              
            </ul>
            <div id="myTab2Content" class="tab-content">
              <div id="seances" role="tabpanel" aria-labelledby="home-tab" class="tab-pane fade show  active ">
                <div class="btm"><br></div>
                <div class="progress">
                <div  class="progress-bar bg-success" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%;" title="test"></div>
              </div>
                  <!-- <select    class="dropdown-toggle">
                    <option  class="dropdown-item" ></option>
                    <option class="dropdown-item">Masculin</option>
                  </select> -->
                                 <button  (click)="tempaddseance(templateaddseance)" class="btn btn-primary btn-circle btn-circle-sm m-1 " title="Ajouter"><i class="fa fa-plus "></i></button>
                <div class="event-schedule-area-two bg-color ">
  
                    <div class="container">
                        
                        <!-- row end-->
                        <div class="row">
                            
                                
                                <div class="tab-content" id="myTabContent">
                                
                        <br>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th class="text-center" scope="col">Date</th>
                                        <th  scope="col">Détails</th>
                                        <th scope="col">Actions</th>
                                       
                                        
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let seance of seances  | paginate: {id:'pagination', itemsPerPage: 20, currentPage: pages}" class="inner-box">
                                        <th scope="row">
                                            <div class="event-date">
                                                
                                                <span>{{seance.sdate| date:'dd'}}-{{getMonthName(seance.sdate| date:'MM')}}-{{seance.sdate| date:'yyyy'}}</span>
                                                
                                            </div>
                                        </th>
                                        
                                        <td>
                                          <ng-container *ngFor="let detail of seance.details; let i = index">
                                            <span class="badge badge-dot mr-4">
                                              <i class="bg-success"></i> {{ gettraitById(detail.split(',')[0]) }} [{{ detail.split(',')[1] }}]
                                            </span>
                                            <br>
                                            </ng-container>
                                        
                                        </td>
                                        <td>
                                            <div class="primary-btn">
                                             
                                              <button id="editButton" (click)="tempmodseance(templatemodseance,seance.sid)" class="btn btn-primary btn-circle btn-circle-sm m-1" title="Modifier"><i class="fa fa-edit"></i></button>
                                              <button id="deleteButton" (click)="delseance(seance.sid)"  class="btn btn-danger btn-circle btn-circle-sm m-1" title="Supprimer"><i class="fa fa-trash"></i></button>
                                            </div>
                                        </td>
                                     
                                    </tr>
                                   
                                </tbody>
                            </table>
                            <pagination-controls id="pagination" (pageChange)=" pages = $event" previousLabel="" nextLabel="" class="page"></pagination-controls>

                        </div>
                                    </div>
                           
                               
                              
                            
                            <!-- /col end-->
                        </div>
                        <!-- /row end-->
                    </div>
                </div>

            </div>
              <div id="paiements" role="tabpanel" aria-labelledby="home-tab" class="tab-pane fade show   ">
                <div class="btm"><br></div>
              

                  <!-- <select    class="dropdown-toggle">
                    <option  class="dropdown-item" ></option>
                    <option class="dropdown-item">Masculin</option>
                  </select> -->
                                 <button    (click)="tempaddpaie(templateaddpaie)" class="btn btn-primary btn-circle btn-circle-sm m-1 " title="Ajouter"><i class="fa fa-plus "></i></button>
                <div class="event-schedule-area-two bg-color ">
  
                    <div class="container">
                        
                        <!-- row end-->
                        <div class="row">
                            
                                
                                <div class="tab-content" id="myTabContent">
                                
                        <br>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th  scope="col">Date</th>
                                        <th  scope="col">Détails</th>
                                        <th   scope="col">Actions</th>
                                       
                                        
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let paie of paiements  | paginate: {id:'pagination', itemsPerPage: 20, currentPage: pages}" class="inner-box">
                                        <th scope="row">
                                            <div class="event-date">
                                                
                                                <span> {{paie.pdate| date:'dd'}}-{{getMonthName(paie.pdate| date:'MM')}}-{{paie.pdate| date:'yyyy'}}</span>
                                               
                                            </div>
                                        </th>
                                        
                                        <td>
                                            <div class="event-wrap">
                                                   
                                                    <div class="categories">
                                                        <a class="mnt"> {{paie.pmnt}} UM</a>
                                                        <a class="mode">{{getmodeById(paie.pmode)}}</a>
                                                    </div>
                                               
                                            </div>
                                        </td>
                                        <td>
                                            <div class="primary-btn">
                                             
                                              <button id="editButton" (click)="tempmodpaie(templatemodpaie,paie.pid)" class="btn btn-primary btn-circle btn-circle-sm m-1" title="Modifier"><i class="fa fa-edit"></i></button>
                                              <button id="deleteButton" (click)="delpaie(paie.pid)"  class="btn btn-danger btn-circle btn-circle-sm m-1" title="Supprimer"><i class="fa fa-trash"></i></button>
                                            </div>
                                        </td>
                                     
                                    </tr>
                                   
                                </tbody>
                            </table>
                            <pagination-controls id="pagination" (pageChange)=" pages = $event" previousLabel="" nextLabel="" class="page"></pagination-controls>

                        </div>
                                    </div>
                           
                               
                              
                            
                            <!-- /col end-->
                        </div>
                        <!-- /row end-->
                    </div>
                </div>

            </div>
            </div>
          </div>
      </div>
         </div>

</dialog>



<ng-template #templateaddseance>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Ajouter Seances</h4>
    <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="hideandopendialog()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
   
        
          <div class="c1">
            <form [formGroup]="formAddseance" (ngSubmit)="addseance()" >
              <div class="row">
            <div class="col" >
              <label class="labelmod" for="Nom">Date <span>*</span></label>
              <input  class="input"   type="date" formControlName="DT" >
            </div>
            <div class="col" >
              <label class="labelmod" >Traitement <span>*</span> </label>
              <ng-select class="custom"
              [items]="listraitinseance"
              bindLabel="name"
              placeholder="Sélectionner des traitements"
              appendTo="body"
              [multiple]="true"
              [closeOnSelect]="false"
[searchable]="false"
formControlName="SN"
(change)="onSelectionChange($event)">
             >
   </ng-select>
            </div>
              </div>
              <div class="row">
                
      
                <div class="col" >
                  <label class="labelmod">Notes  </label>
                  <textarea formControlName="NOTE" cols="10" rows="5"></textarea>
            </div>
            <div class="col" >
            </div>
           
          </div>
         
             
      
      
             
        <br>
        
        <table class="nbreseance-table">
          <tr class="nbreseance-row">
            <th class="nbreseance-header">Traitement</th>
            <th class="nbreseance-header">Nbre séances</th>
          </tr>
          <tr class="nbreseance-row" *ngFor="let item of selected; let i = index">
            <td class="nbreseance-cell">{{ item.name }}</td>
            <td class="nbreseance-cell nbre">
              <input type="number" #nbreInput (input)="updateNbre(i, nbreInput.value)" value="{{ item.nbre }}">
            </td>
          </tr>
          

       
        </table>

              <div  *ngIf="formAddseance.invalid">
                <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
              </div>
              <input type="submit" [disabled]="buttondisable==true"  value="Ajouter">
             
             
         

        
            </form>

    </div>
    </div>
    </ng-template>  
    <ng-template #templatemodseance>
      <div class="modal-header">
        <h4 class="modal-title pull-left">Modifier Seances</h4>
        <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="hideandopendialog()">
          <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>
      </div>
      <div class="modal-body">
       
            
              <div class="c1">
                <form [formGroup]="formAddseance" (ngSubmit)="modseance()" >
                  <div class="row">
                    <div class="col" >
                      <label class="labelmod" for="Nom">Date <span>*</span></label>
                      <input  class="input"   type="date" formControlName="DT" >
                    </div>
                    <div class="col" >
                      <label class="labelmod" >Traitement <span>*</span> </label>
                      <ng-select class="custom"
                      [items]="listraitinseance"
                      bindLabel="name"
                      placeholder="Sélectionner des traitements"
                      appendTo="body"
                      [multiple]="true"
                      [closeOnSelect]="false"
        [searchable]="false"
        formControlName="SN"
        (change)="onSelectionChange($event)">
                     >
           </ng-select>
                    </div>
                      </div>
                      <div class="row">
                        
              
                        <div class="col" >
                          <label class="labelmod">Notes  </label>
                          <textarea formControlName="NOTE" cols="10" rows="5"></textarea>
                    </div>
                    <div class="col" >
                    </div>
                   
                  </div>
                 
                     
              
              
                     
                <br>
                
                <table class="nbreseance-table">
                  <tr class="nbreseance-row">
                    <th class="nbreseance-header">Traitement</th>
                    <th class="nbreseance-header">Nbre séances</th>
                  </tr>
                  <tr class="nbreseance-row" *ngFor="let item of selected; let i = index">
                    <td class="nbreseance-cell">{{ item.name }}</td>
                    <td class="nbreseance-cell nbre">
                      <input type="number" min="1" #nbreInput (input)="updateNbre(i, nbreInput.value)" value="{{ item.nbre }}">
                    </td>
                  </tr>
  
            </table>
    
                  <div  *ngIf="formAddseance.invalid">
                    <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                  </div>
                  <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
                 
                 
             
    
            
                </form>
    
        </div>
        </div>
        </ng-template>  

  <ng-template #templateaddpaie>
          <div class="modal-header">
            <h4 class="modal-title pull-left">Ajouter Paiement</h4>
            <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="hideandopendialog()">
              <span aria-hidden="true" class="visually-hidden">&times;</span>
            </button>
          </div>
          <div class="modal-body">
           
                
                  <div class="c1">
                    <form [formGroup]="formAddpaie" (ngSubmit)="addpaie()" >
                      <div class="row">
                    <div class="col" >
                      <label class="labelmod" for="Nom">Date <span>*</span></label>
                      <input  class="input"   type="date" formControlName="DT" >
                    </div>
                    <div class="col" >
                      <label class="labelmod" >Mode de paiement<span>*</span> </label>
                      <select    formControlName="MODE" >
                        <option *ngFor="let mode of modepaie"  value="{{mode.mpid}}">{{mode.mpnm}}</option>  
                      </select>
         
                    </div>
                      </div>
                      <div class="row">
                        <div class="col" >
                            <label class="labelmod" for="Nom">Montant <span>*</span></label>
                            <input  class="input"   type="number" formControlName="MNT" > 
                    </div>
                    <div class="col" >
                      <label class="labelmod">Notes  </label>
                      <textarea formControlName="NOTE" cols="10" rows="5"></textarea>
                    </div>
                   
                  </div>
                 
                     
              
              
                     
                <br>
                
           
        
                      <div  *ngIf="formAddpaie.invalid">
                        <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                      </div>
                      <input type="submit" [disabled]="buttondisable==true"  value="Ajouter">
                     
                     
                 
        
                
                    </form>
        
            </div>
            </div>
            </ng-template>  
  <ng-template #templatemodpaie>
    <div class="modal-header">
      <h4 class="modal-title pull-left">Modifier Paiement</h4>
      <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="hideandopendialog()">
        <span aria-hidden="true" class="visually-hidden">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      
          
            <div class="c1">
              <form [formGroup]="formAddpaie" (ngSubmit)="modpaie()" >
                <div class="row">
              <div class="col" >
                <label class="labelmod" for="Nom">Date <span>*</span></label>
                <input  class="input"   type="date" formControlName="DT" >
              </div>
              <div class="col" >
                <label class="labelmod" >Mode de paiement<span>*</span> </label>
                <select    formControlName="MODE" >
                  <option *ngFor="let mode of modepaie"  value="{{mode.mpid}}">{{mode.mpnm}}</option>
                </select>
    
              </div>
                </div>
                <div class="row">
                  
        
                  <div class="col" >
                      <label class="labelmod" for="Nom">Montant <span>*</span></label>
                      <input  class="input"   type="number" formControlName="MNT" >
              </div>
              <div class="col" >
                <label class="labelmod">Notes  </label>
                <textarea formControlName="NOTE" cols="10" rows="5"></textarea>
              </div>
              
            </div>
            
                
        
        
                
          <br>
          
      
  
                <div  *ngIf="formAddpaie.invalid">
                  <div   class="errorModEmp" >les champs avec étoiles sont obligatoires</div>
                </div>
                <input type="submit" [disabled]="buttondisable==true"  value="Modifier">
                
                
            
  
          
              </form>
  
      </div>
      </div>
      </ng-template>  
                    
    <div class="modal fade" id="form" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    
          <div class="modal-content  px-md-4 p-sm-3 p-4">
          
         
            <a  (click)="closetempinforendez()"> <i class="fa fa-close"></i></a>
            <p class="r3 px-md-5 px-sm-1">{{ note ? note : 'aucune note' }}</p>
             
              
              
          </div>
      
  </div>
     </body>
 </html>
 